<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-pink.min.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }
    .nodes circle {
      stroke: #fff;
    }
    .txt {
      font-family: 'Roboto', sans-serif;
    }
    .nodes text{
      display: none;
    }
    .nodes:hover text.txt{
      display: inline;
    }
    .nodes:active text.url{
      display: inline;
    }
    svg {
      display: flex;
      position: absolute;
      top:0;
      left:0;
      bottom:0;
      right:0;
      width: 100%;
      height: 100%;
    }
    .btn1 {
      display: flex;
      position: absolute;
      top: 20px;
      left: 30px;
      z-index: 100;
    }
    </style>
  </head>
  <body>
    <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored btn1"> <i class="material-icons">replay</i> </button>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>    <svg></svg>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
      var width = window.innerWidth;
      var height= window.innerHeight;
      var svg = d3.select("svg")
      .attr('height', height)
      .attr('width', width)
      .call(d3.zoom().on("zoom", function () {
        svg.attr("transform", d3.event.transform)
      }))
      .append('g');

      // var color = d3.scaleOrdinal(d3.schemeCategory20);
      color=['#EC407A','#78909C','#EC407A','#78909C'];

      var simulation = d3.forceSimulation()
      .force("link", d3.forceLink().id(function(d) { return d.id; })
      .distance(function(d){return d.value== 1? 300: 300;}))
      .force("charge", d3.forceManyBody())
      .force("center", d3.forceCenter(width / 2, height / 2));

      // function makerandomlinks(innode, tags) {
      //   outlinks= []
      // for (i=0; i<innode.length; i++) {
      //       linkto= Math.floor(Math.random()*tags.length);
      //       outlinks.push( {'source':innode[i].id, 'target': tags[linkto].id, 'value': 1} )
      //   }
      //   return outlinks
      // }
      // d3.json("links.json", function(error, nodette) {
      //   tags=[]
      //   for (i=0; i<nodette.length/3; i++){
      //     tags.push({'title':"TAG"+i, 'id':"TAG"+i, 'group':2 })
      //   }

      d3.json("awesomelinks.json", function(error, graph) {
        graph.nodes.push({"id": "AWESOME- Dot Files","title": "AWESOME- Dot Files","group": 2})
        var boo= graph.nodes.filter(function(elt){return elt.group==2})
        for (var i=0; i<boo.length; i++){
          graph.links.push({'source':"AWESOME- Dot Files", 'target':boo[i] , 'value': 2})
        }
        if (error) throw error;

        var link = svg.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(graph.links)
        .enter().append("line")
        .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

        var node = svg.append("g")
        .selectAll("circle")
        .data(graph.nodes)
        .enter()
        .append('g')
        .attr("class", function(d) { return d.group==1 ? "nodes": "tag"; })

        var circle=node.append("circle")
        .attr("r", 7)
        .attr("fill", function(d) { return color[d.group];})

        var txt=node.append("text")
        .text(function(d) { return d.title; })
        .attr('class','txt');

        var url=node.append("text")
        .text(function(d) { return d.group==1 ? d.id:""; })
        .attr('class','url');

        circle.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

        simulation.nodes(graph.nodes)
        .on("tick", ticked)
        .force("link")
        .links(graph.links);

        function ticked() {
          link
          .attr("x1", function(d) { return d.source.x; })
          .attr("y1", function(d) { return d.source.y; })
          .attr("x2", function(d) { return d.target.x; })
          .attr("y2", function(d) { return d.target.y; });
          txt
          .attr("x", function(d) { return d.x+10; })
          .attr("y", function(d) { return d.y+10; });
          url
          .attr("x", function(d) { return d.x+10; })
          .attr("y", function(d) { return d.y+25; });
          circle
          .attr("cx", function(d) { return d.x; })
          .attr("cy", function(d) { return d.y; });
        }
      });

      function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
      }

      function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
      }

      function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = d.x;
        d.fy = d.y;
      }

      function resetted() {
      // this should probably do something at some point
    }

    </script>
  </body>
</head>
